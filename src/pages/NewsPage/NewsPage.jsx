// src/pages/NewsPage/NewsPage.jsx

// üéØ –®–ê–ì 1: –ò–ú–ü–û–†–¢–´
import { useState, useEffect } from 'react'; // üéØ React —Ö—É–∫–∏
import Title from '../../components/Title/Title'; // üéØ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
import SearchField from '../../components/SearchField/SearchField'; // üéØ –ü–æ–∏—Å–∫
import NewsList from '../../components/News/NewsList/NewsList'; // üéØ –°–ø–∏—Å–æ–∫ –Ω–æ–≤–æ—Å—Ç–µ–π
import Pagination from '../../components/Pagination/Pagination'; // üéØ –ü–∞–≥–∏–Ω–∞—Ü–∏—è
import newsApi from '../../services/newsApi'; // üéØ –ù–∞—à API —Å–µ—Ä–≤–∏—Å
import styles from './NewsPage.module.css'; // üéØ –°—Ç–∏–ª–∏

// üéØ –®–ê–ì 2: –°–û–ó–î–ê–ï–ú –ö–û–ú–ü–û–ù–ï–ù–¢ NewsPage
// –≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –≤ React)
export const NewsPage = () => {
  
  // üéØ –®–ê–ì 3: –°–û–°–¢–û–Ø–ù–ò–Ø –ö–û–ú–ü–û–ù–ï–ù–¢–ê (useState)
  // useState - —Ö—É–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
  
  // üéØ news - –º–∞—Å—Å–∏–≤ –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  // –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ []
  const [news, setNews] = useState([]);
  
  // üéØ loading - —Ñ–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ (true/false)
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏–Ω–Ω–µ—Ä –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –≥—Ä—É–∑—è—Ç—Å—è
  const [loading, setLoading] = useState(false);
  
  // üéØ searchKeyword - –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ '' (–Ω–µ—Ç –ø–æ–∏—Å–∫–∞)
  const [searchKeyword, setSearchKeyword] = useState('');
  
  // üéØ currentPage - —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  // –ù–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  const [currentPage, setCurrentPage] = useState(1);
  
  // üéØ totalPages - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
  // –ù–∞—á–∏–Ω–∞–µ–º —Å 1 (–±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö)
  const [totalPages, setTotalPages] = useState(1);
  
  // üéØ –®–ê–ì 4: useEffect –î–õ–Ø –ó–ê–ì–†–£–ó–ö–ò –î–ê–ù–ù–´–•
  // useEffect - —Ö—É–∫ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (–∑–∞–ø—Ä–æ—Å—ã –∫ API)
  // –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏:
  // 1. –ü–µ—Ä–≤–æ–º —Ä–µ–Ω–¥–µ—Ä–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  // 2. –ò–∑–º–µ–Ω–µ–Ω–∏–∏ currentPage
  // 3. –ò–∑–º–µ–Ω–µ–Ω–∏–∏ searchKeyword
  
  useEffect(() => {
    // üéØ –°–û–ó–î–ê–ï–ú –§–£–ù–ö–¶–ò–Æ loadNews –í–ù–£–¢–†–ò useEffect
    // –ü–æ—á–µ–º—É –≤–Ω—É—Ç—Ä–∏? –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–∫–∏ ESLint —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
    const loadNews = async () => {
      // üéØ –ù–ê–ß–ò–ù–ê–ï–ú –ó–ê–ì–†–£–ó–ö–£
      setLoading(true); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
      
      try {
        // üéØ –í–´–ó–´–í–ê–ï–ú –ù–ê–® API –°–ï–†–í–ò–°
        // –ü–µ—Ä–µ–¥–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
        // - page: —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        // - limit: 6 –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ –¢–ó)
        // - keyword: –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)
        const result = await newsApi.getNews({
          page: currentPage,
          limit: 6,
          keyword: searchKeyword // üéØ –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢: keyword, –Ω–µ query!
        });
        
        // üéØ –ü–†–û–í–ï–†–Ø–ï–ú –†–ï–ó–£–õ–¨–¢–ê–¢
        if (result.success) {
          // üéØ –£–°–ü–ï–•: –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
          setNews(result.data); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤–æ—Å—Ç–∏
          setTotalPages(result.pagination.totalPages); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
        } else {
          // üéØ –û–®–ò–ë–ö–ê API: –ª–æ–≥–∏—Ä—É–µ–º –∏ –æ—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ
          console.error('–û—à–∏–±–∫–∞ API:', result.error);
          setNews([]); // –û—á–∏—â–∞–µ–º –Ω–æ–≤–æ—Å—Ç–∏
          setTotalPages(1); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
        }
      } catch (error) {
        // üéØ –ù–ï–û–ñ–ò–î–ê–ù–ù–ê–Ø –û–®–ò–ë–ö–ê (—Å–µ—Ç—å, —Å–µ—Ä–≤–µ—Ä –∏ —Ç.–¥.)
        console.error('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
        setNews([]);
        setTotalPages(1);
      } finally {
        // üéØ –í–°–ï–ì–î–ê –ó–ê–í–ï–†–®–ê–ï–ú –ó–ê–ì–†–£–ó–ö–£
        // finally –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ, –∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        setLoading(false); // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
      }
    };
    
    // üéØ –í–´–ó–´–í–ê–ï–ú –§–£–ù–ö–¶–ò–Æ –ó–ê–ì–†–£–ó–ö–ò
    loadNews();
    
  }, [currentPage, searchKeyword]); 
  // üéØ –ú–ê–°–°–ò–í –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô:
  // useEffect –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —ç—Ç–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
  // currentPage - –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  // searchKeyword - –ø—Ä–∏ –Ω–æ–≤–æ–º –ø–æ–∏—Å–∫–µ
  
  // üéØ –®–ê–ì 5: –û–ë–†–ê–ë–û–¢–ß–ò–ö –ü–û–ò–°–ö–ê
  // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç –≤ SearchField
  const handleSearch = (keyword) => {
    setSearchKeyword(keyword); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
    setCurrentPage(1); // üéØ –í–ê–ñ–ù–û: —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –Ω–æ–≤–æ–º –ø–æ–∏—Å–∫–µ
  };
  
  // üéØ –®–ê–ì 6: –û–ë–†–ê–ë–û–¢–ß–ò–ö –ü–ê–ì–ò–ù–ê–¶–ò–ò
  // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  const handlePageChange = (page) => {
    setCurrentPage(page); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    window.scrollTo({ top: 0, behavior: 'smooth' }); // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  };
  
  // üéØ –®–ê–ì 7: –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–ù–û–ü–û–ö –ü–ê–ì–ò–ù–ê–¶–ò–ò
  // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ [1, 2, 3, ..., totalPages] –¥–ª—è Pagination –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  const paginationButtons = Array.from(
    { length: totalPages }, // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–ª–∏–Ω–æ–π totalPages
    (_, i) => i + 1 // –ó–∞–ø–æ–ª–Ω—è–µ–º —á–∏—Å–ª–∞–º–∏ –æ—Ç 1 –¥–æ totalPages
  );
  
  // üéØ –®–ê–ì 8: –†–ï–ù–î–ï–† –ö–û–ú–ü–û–ù–ï–ù–¢–ê
  // JSX - —Ç–æ —á—Ç–æ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  return (
    // üéØ section - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π HTML —Ç–µ–≥ –¥–ª—è —Å–µ–∫—Ü–∏–∏
    // className={styles.sectionNews} - –ø—Ä–∏–º–µ–Ω—è–µ–º CSS —Å—Ç–∏–ª–∏
    <section className={styles.sectionNews}>
      
      {/* üéØ –£–°–õ–û–í–ù–´–ô –†–ï–ù–î–ï–†–ò–ù–ì: –ó–ê–ì–†–£–ó–ö–ê */}
      {/* –ï—Å–ª–∏ loading = true, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä */}
      {loading ? (
        <div className={styles.loader}>
          –ó–∞–≥—Ä—É–∑–∫–∞... {/* –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π —Å–ø–∏–Ω–Ω–µ—Ä */}
        </div>
      ) : (
        // üéØ –ï–°–õ–ò –ù–ï –ì–†–£–ó–ò–¢–°–Ø - –ü–û–ö–ê–ó–´–í–ê–ï–ú –ö–û–ù–¢–ï–ù–¢
        // ul - –Ω–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–¥–ª—è —Å–µ–º–∞–Ω—Ç–∏–∫–∏)
        <ul className={styles.newsContainer}>
          
          {/* üéØ –ü–ï–†–í–´–ô –≠–õ–ï–ú–ï–ù–¢: –ó–ê–ì–û–õ–û–í–û–ö –ò –ü–û–ò–°–ö */}
          <li className={styles.titleAndSearch}>
            {/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å —Ç–µ–∫—Å—Ç–æ–º "News" */}
            <Title children="News" />
            
            {/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∏—Å–∫–∞ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º handleSearch */}
            <SearchField onSearch={handleSearch} />
          </li>
          
          {/* üéØ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ü–û–ò–°–ö–ï (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–∏—Å–∫) */}
          {/* –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥: && - –µ—Å–ª–∏ searchKeyword –Ω–µ –ø—É—Å—Ç–æ–π */}
          {searchKeyword && (
            <li className={styles.searchInfo}>
              <p>
                –ü–æ–∏—Å–∫: "{searchKeyword}" ‚Ä¢ –°—Ç—Ä–∞–Ω–∏—Ü–∞ {currentPage} –∏–∑ {totalPages}
              </p>
            </li>
          )}
          
          {/* üéØ –°–ü–ò–°–û–ö –ù–û–í–û–°–¢–ï–ô */}
          <li className={styles.noticesList}>
            {/* –ü–µ—Ä–µ–¥–∞–µ–º –º–∞—Å—Å–∏–≤ news –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç NewsList */}
            <NewsList news={news} />
          </li>
          
          {/* üéØ –ü–ê–ì–ò–ù–ê–¶–ò–Ø (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–æ–ª—å—à–µ 1 —Å—Ç—Ä–∞–Ω–∏—Ü—ã) */}
          {/* –ü–æ –¢–ó: –ø–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ totalPages > 1 */}
          <li className={styles.pagination}>
            {totalPages > 1 && (
              <Pagination
                numberOfPages={paginationButtons}
                totalPages={totalPages}
                setToPage={handlePageChange}
                toPage={currentPage}
              />
            )}
          </li>
          
        </ul>
      )}
    </section>
  );
  // üéØ –ö–û–ù–ï–¶ –†–ï–ù–î–ï–†–ê –ö–û–ú–ü–û–ù–ï–ù–¢–ê
};

// üéØ –®–ê–ì 9: –≠–ö–°–ü–û–†–¢ –ö–û–ú–ü–û–ù–ï–ù–¢–ê
// –î–µ–ª–∞–µ–º NewsPage –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ App.jsx
export default NewsPage;